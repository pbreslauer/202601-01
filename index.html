<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Tracker</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; padding: 20px; text-align: center; }
        .bus-row { 
            border: 1px solid #333; margin: 10px 0; padding: 15px; border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .route-id { font-size: 1.5rem; font-weight: bold; color: #888; }
        .eta { font-size: 2.5rem; font-weight: 800; color: #00FF41; }
        .dir { font-size: 0.8rem; color: #555; text-transform: uppercase; }
    </style>
</head>
<body>
    <h3>21st & Wallace</h3>
    <div id="busList">Loading all arrivals...</div>
    <div id="status" style="margin-top:20px; color:#444; font-size:0.8rem;"></div>

    <script>
        async function fetchAll() {
            try {
                const STOP_ID = '21102';
                const url = `https://www3.septa.org/api/Arrivals/index.php?stop_id=${STOP_ID}&results=5`;
                const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
                const data = await response.json();
                
                const stopKey = Object.keys(data)[0];
                const arrivals = data[stopKey];
                const listDiv = document.getElementById('busList');
                listDiv.innerHTML = ""; // Clear current list

                if (Array.isArray(arrivals)) {
                    arrivals.forEach(bus => {
                        listDiv.innerHTML += `
                            <div class="bus-row">
                                <div style="text-align:left">
                                    <div class="route-id">Bus ${bus.route}</div>
                                    <div class="dir">${bus.destination}</div>
                                </div>
                                <div class="eta">${bus.arrival_at}<span style="font-size:1rem">m</span></div>
                            </div>`;
                    });
                    document.getElementById('status').innerText = "Updated: " + new Date().toLocaleTimeString();
                } else {
                    listDiv.innerHTML = "No active buses found in SEPTA feed.";
                }
            } catch (err) {
                document.getElementById('busList').innerHTML = "Connection Error. Retrying...";
            }
        }

        fetchAll();
        setInterval(fetchAll, 30000);
    </script>
</body>
</html>
